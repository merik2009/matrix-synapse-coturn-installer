# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç - Matrix Synapse + Coturn

## üöÄ –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
sudo apt update && sudo apt upgrade -y

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
sudo timedatectl set-timezone Europe/Moscow
```

### 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫
```bash
# –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å git
git clone <your-repo-url> matrix-server
cd matrix-server

# –ò–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ –∏ —Ä–∞—Å–ø–∞–∫—É–π—Ç–µ –∞—Ä—Ö–∏–≤
# –ó–∞—Ç–µ–º –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞

# –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
sudo ./install.sh
```

### 3. –ß—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–≤–µ—Å—Ç–∏:
- **–î–æ–º–µ–Ω Matrix**: matrix.yourdomain.com
- **–ò–º—è —Å–µ—Ä–≤–µ—Ä–∞**: yourdomain.com  
- **Email**: your@email.com (–¥–ª—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤)
- **–ü–∞—Ä–æ–ª—å –ë–î**: –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è PostgreSQL
- **–ü–æ—Ä—Ç—ã**: –æ–±—ã—á–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–¥—Ö–æ–¥—è—Ç

### 4. DNS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ DNS –∑–∞–ø–∏—Å–∏:
```
A    matrix.yourdomain.com    ‚Üí  YOUR_SERVER_IP
A    yourdomain.com          ‚Üí  YOUR_SERVER_IP
SRV  _matrix._tcp.yourdomain.com  ‚Üí  10 0 8448 matrix.yourdomain.com
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
```bash
# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
./scripts/monitor.sh services

# –ü–æ–ª–Ω–∞—è –ø–∞–Ω–µ–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
./scripts/monitor.sh

# –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
curl https://matrix.yourdomain.com/_matrix/federation/v1/version
```

---

## üê≥ Docker —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

–ï—Å–ª–∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ Docker:
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
curl -fsSL https://get.docker.com | sh
sudo usermod -aG docker $USER

# –ü–µ—Ä–µ–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
newgrp docker

# –ó–∞–ø—É—Å–∫ Docker —É—Å—Ç–∞–Ω–æ–≤–∫–∏
./docker/install-docker.sh
```

---

## üì± –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤

1. –°–∫–∞—á–∞–π—Ç–µ Element –∏–ª–∏ –¥—Ä—É–≥–æ–π Matrix –∫–ª–∏–µ–Ω—Ç
2. –ü—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –≤–≤–µ–¥–∏—Ç–µ:
   - **–°–µ—Ä–≤–µ—Ä**: https://matrix.yourdomain.com
   - **–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: admin (–∏–ª–∏ —Å–æ–∑–¥–∞–Ω–Ω–æ–µ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ)
   - **–ü–∞—Ä–æ–ª—å**: —Ç–æ—Ç —á—Ç–æ –∑–∞–¥–∞–ª–∏ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

---

## ‚ö° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
./scripts/update.sh

# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
./scripts/backup.sh

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
./scripts/monitor.sh dashboard

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
sudo journalctl -u matrix-synapse -f

# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo -u synapse /var/lib/synapse/venv/bin/register_new_matrix_user \
    -c /etc/synapse/homeserver.yaml

# –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è)
./scripts/uninstall.sh
```

---

## üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –°–µ—Ä–≤–µ—Ä –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
sudo systemctl status matrix-synapse coturn nginx

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo systemctl restart matrix-synapse
```

### –û—à–∏–±–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∏–ª–∏ pkg_resources
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
./scripts/fix-synapse.sh

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
sudo chown -R synapse:synapse /etc/synapse /var/lib/synapse /var/log/synapse
sudo systemctl restart matrix-synapse
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å SSL
```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
sudo certbot renew
sudo systemctl reload nginx
```

### –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—à–∏–±–æ–∫
sudo journalctl -u matrix-synapse --since "1 hour ago" | grep -i error
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `./scripts/monitor.sh`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ DNS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã: `sudo ufw status`
4. –°–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

**–£—Å–ø–µ—à–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏! üéâ**
